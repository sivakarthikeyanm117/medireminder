<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Add Reminder ‚Äî MediReminder</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --primary-start: #26c6da;
  --primary-end: #009688;
  --bg-start: #d5f4f9;
  --bg-end: #dbd9de;
  --text-dark: #03363d;
  --text-muted: #546e7a;
  --glass: rgba(255,255,255,0.7);
  --particle-color: rgba(38,198,218,0.25);
}

/* ===== BASE ===== */
* { margin:0; padding:0; box-sizing:border-box; font-family:'Inter',sans-serif; }
body {
  height:100vh;
  background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden;
}

/* ===== FLOATING BUBBLES ===== */
.bubbles { position:absolute; inset:0; z-index:0; pointer-events:none; }
.bubble {
  position:absolute;
  border-radius:50%;
  background: var(--particle-color);
  animation: float linear infinite;
}
@keyframes float {
  0% { transform: translateY(0) scale(var(--scale)); opacity:0.3; }
  50% { opacity:0.6; }
  100% { transform: translateY(-120vh) scale(var(--scale)); opacity:0; }
}

/* ===== CARD ===== */
.add-card {
  position: relative;
  z-index:1;
  background: var(--glass);
  backdrop-filter: blur(20px);
  border-radius: 32px;
  padding: 60px 80px;
  width: 100%;
  max-width: 700px;
  text-align: center;
  box-shadow: 0 15px 40px rgba(0,0,0,0.1);
}

/* ===== HEADINGS ===== */
.add-card h1 {
  font-family: 'Poppins', sans-serif;
  font-size: 2.8rem;
  font-weight: 800;
  margin-bottom: 15px;
  color: var(--primary-end);
}
.add-card p {
  font-size: 1.2rem;
  color: var(--text-muted);
  margin-bottom: 40px;
}

/* ===== FORM ===== */
form { display:flex; flex-direction:column; gap:20px; text-align:left; }
label { font-weight:600; color: var(--text-dark); margin-bottom:5px; }
input, select {
  padding: 14px 18px;
  border-radius: 15px;
  border:none;
  background: rgba(255,255,255,0.7);
  backdrop-filter: blur(10px);
  font-size:1rem;
  color: var(--text-dark);
  transition: all 0.3s ease;
}
input:focus, select:focus { outline:none; box-shadow:0 0 10px var(--primary-start); }

/* ===== BUTTON ===== */
.btn {
  padding: 16px 35px;
  font-size: 1.1rem;
  font-weight:700;
  border-radius: 30px;
  border:none;
  cursor:pointer;
  background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
  color:#fff;
  box-shadow:0 6px 16px rgba(0,0,0,0.2);
  align-self:center;
  transition: all 0.3s ease;
  position:relative;
  overflow:hidden;
}
.btn:hover {
  transform: translateY(-4px) scale(1.06);
  box-shadow:0 12px 28px rgba(0,0,0,0.15), 0 0 20px var(--primary-start);
}

/* ===== SHINE EFFECT ===== */
.btn::before {
  content:"";
  position:absolute;
  top:0; left:-75%;
  width:50%; height:100%;
  background: linear-gradient(120deg, rgba(255,255,255,0.6), rgba(255,255,255,0));
  transform: skewX(-25deg);
}
.btn:hover::before { animation: shine 0.8s forwards; }
@keyframes shine { 100% { left:125%; } }

@media(max-width:768px){
  .add-card { padding: 40px 30px; }
  .add-card h1 { font-size:2.3rem; }
  .btn { width:200px; font-size:1rem; padding:15px 0; }
}
</style>
</head>
<body>

<section class="hero">
  <!-- Floating Bubbles -->
  <div class="bubbles" id="bubbles"></div>

  <!-- Main Card -->
  <div class="add-card">
    <h1>Add Medication Reminder</h1>
    <p>Set up reminders for your medications to stay healthy and on track</p>

    <form>
      <div>
        <label for="medication">Medication Name</label>
        <input type="text" id="medication" name="medication" placeholder="Enter medicine name">
      </div>
      <div>
        <label for="dose">Dosage</label>
        <input type="text" id="dose" name="dose" placeholder="e.g., 10mg">
      </div>
      <div>
        <label for="date">Date</label>
        <input type="date" id="date" name="date">
      </div>
      <div>
        <label for="time">Time</label>
        <input type="time" id="time" name="time" step="60">
      </div>
      <div>
        <label for="timeFormat">Time Format</label>
        <select id="timeFormat" name="timeFormat">
          <option value="12">12 Hour (AM/PM)</option>
          <option value="24">24 Hour</option>
        </select>
      </div>
      <div>
        <label for="frequency">Frequency</label>
        <select id="frequency" name="frequency">
          <option value="once">Once</option>
          <option value="daily">Daily</option>
          <option value="weekly">Weekly</option>
        </select>
      </div>
      <div>
        <label for="phone">Phone Number (for WhatsApp)</label>
        <input type="tel" id="phone" name="phone" placeholder="+1234567890 (optional)">
      </div>
      <div>
        <label for="notificationType">Notification Type</label>
        <select id="notificationType" name="notificationType">
          <option value="web">Web Notification</option>
          <option value="whatsapp">WhatsApp Message</option>
          <option value="both">Both Web & WhatsApp</option>
        </select>
      </div>
      <button class="btn" type="submit" onclick="addReminder(event)">Add Reminder</button>
      <button class="btn" type="button" onclick="testNotification()" style="background: linear-gradient(135deg, #ff6b6b, #ee5a52); margin-top: 10px;">üîî Test Notification</button>
      <button class="btn" type="button" onclick="testWhatsApp()" style="background: linear-gradient(135deg, #25D366, #128C7E); margin-top: 10px;">üì± Test WhatsApp</button>
      <button class="btn" type="button" onclick="window.location.href='index.html'" style="background: linear-gradient(135deg, #6c757d, #495057); margin-top: 10px;">üè† Go Home</button>
    </form>
  </div>
</section>

<script>
// Request notification permission on page load
document.addEventListener('DOMContentLoaded', function() {
  console.log('Page loaded, checking notification support...');
  
  if ('Notification' in window) {
    console.log('Notifications are supported');
    console.log('Current permission:', Notification.permission);
    
    if (Notification.permission === 'default') {
      console.log('Requesting notification permission...');
      Notification.requestPermission().then(function(permission) {
        console.log('Permission result:', permission);
        if (permission === 'granted') {
          console.log('‚úÖ Notification permission granted!');
          showNotificationStatus('‚úÖ Notifications enabled!');
        } else {
          console.log('‚ùå Notification permission denied');
          showNotificationStatus('‚ùå Notifications blocked. Please enable in browser settings.');
        }
      });
    } else if (Notification.permission === 'granted') {
      console.log('‚úÖ Notifications already enabled');
      showNotificationStatus('‚úÖ Notifications enabled!');
    } else {
      console.log('‚ùå Notifications blocked');
      showNotificationStatus('‚ùå Notifications blocked. Please enable in browser settings.');
    }
  } else {
    console.log('‚ùå This browser does not support notifications');
    showNotificationStatus('‚ùå Browser does not support notifications');
  }
});

// Show notification status
function showNotificationStatus(message) {
  const statusDiv = document.createElement('div');
  statusDiv.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: #333;
    color: white;
    padding: 10px 15px;
    border-radius: 5px;
    z-index: 1000;
    font-size: 14px;
  `;
  statusDiv.textContent = message;
  document.body.appendChild(statusDiv);
  
  setTimeout(() => {
    statusDiv.remove();
  }, 3000);
}

// Add reminder function
function addReminder(event) {
  event.preventDefault();
  
  const medication = document.getElementById('medication').value;
  const dose = document.getElementById('dose').value;
  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value;
  const frequency = document.getElementById('frequency').value;
  const phone = document.getElementById('phone').value;
  const notificationType = document.getElementById('notificationType').value;
  const timeFormat = document.getElementById('timeFormat').value;
  
  if (!medication || !dose || !date || !time) {
    alert('Please fill in all required fields!');
    return;
  }
  
  // Validate phone number if WhatsApp is selected
  if ((notificationType === 'whatsapp' || notificationType === 'both') && !phone) {
    alert('Phone number is required for WhatsApp notifications!');
    return;
  }
  
  // Create reminder object
  const reminder = {
    id: Date.now(),
    medication: medication,
    dose: dose,
    date: date,
    time: time,
    frequency: frequency,
    phone: phone,
    notificationType: notificationType,
    timeFormat: timeFormat,
    created: new Date().toISOString()
  };
  
  // Get existing reminders
  let reminders = JSON.parse(localStorage.getItem('mediremainder_reminders') || '[]');
  reminders.push(reminder);
  
  // Save to localStorage
  localStorage.setItem('mediremainder_reminders', JSON.stringify(reminders));
  
  // Schedule notifications
  scheduleNotification(reminder);
  
  // Show success message
  alert('Reminder added successfully! You will receive notifications at the scheduled time.');
  
  // Clear form
  document.querySelector('form').reset();
}

// Schedule notification function
function scheduleNotification(reminder) {
  const reminderDateTime = new Date(reminder.date + 'T' + reminder.time);
  const now = new Date();
  
  if (reminderDateTime > now) {
    const timeUntilReminder = reminderDateTime.getTime() - now.getTime();
    
    console.log(`Scheduling notification for ${reminder.medication} at ${reminderDateTime}`);
    console.log(`Time until reminder: ${timeUntilReminder}ms (${Math.round(timeUntilReminder/1000/60)} minutes)`);
    
    setTimeout(() => {
      console.log('Triggering notification now!');
      
      // Web notification
      if ((reminder.notificationType === 'web' || reminder.notificationType === 'both')) {
        if (Notification.permission === 'granted') {
          try {
            const notification = new Notification('üíä Medication Reminder', {
              body: `Time to take ${reminder.medication} (${reminder.dose})`,
              icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üíä</text></svg>',
              tag: 'mediremainder-' + reminder.id,
              requireInteraction: true
            });
            
            notification.onclick = function() {
              window.focus();
              notification.close();
            };
            
            console.log('‚úÖ Web notification sent!');
          } catch (error) {
            console.error('Error creating notification:', error);
            showFallbackNotification(reminder);
          }
        } else {
          console.log('Notification permission not granted, using fallback');
          showFallbackNotification(reminder);
        }
      }
      
      // WhatsApp notification
      if ((reminder.notificationType === 'whatsapp' || reminder.notificationType === 'both') && reminder.phone) {
        sendWhatsAppMessage(reminder);
      }
    }, timeUntilReminder);
  } else {
    console.log('Reminder time has already passed');
  }
}

// Test notification function
function testNotification() {
  console.log('Testing notification...');
  console.log('Current permission:', Notification.permission);
  
  if (Notification.permission === 'granted') {
    try {
      const notification = new Notification('üîî Test Notification', {
        body: 'This is a test notification to check if notifications are working!',
        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üîî</text></svg>',
        requireInteraction: true,
        tag: 'test-notification'
      });
      
      notification.onclick = function() {
        console.log('Notification clicked');
        window.focus();
        notification.close();
      };
      
      console.log('‚úÖ Test notification sent successfully!');
      showNotificationStatus('‚úÖ Test notification sent!');
      
    } catch (error) {
      console.error('Error creating notification:', error);
      alert('Error creating notification: ' + error.message);
    }
  } else if (Notification.permission === 'default') {
    console.log('Requesting permission...');
    Notification.requestPermission().then(function(permission) {
      console.log('Permission result:', permission);
      if (permission === 'granted') {
        testNotification(); // Try again
      } else {
        alert('‚ùå Notification permission denied. Please enable notifications in your browser settings.');
        showNotificationStatus('‚ùå Permission denied');
      }
    });
  } else {
    console.log('Notifications blocked');
    alert('‚ùå Notifications are blocked. Please:\n1. Click the lock icon in your browser address bar\n2. Allow notifications\n3. Refresh the page');
    showNotificationStatus('‚ùå Notifications blocked');
  }
}

// Fallback notification function
function showFallbackNotification(reminder) {
  // Create a visible popup notification
  const popup = document.createElement('div');
  popup.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, #26c6da, #009688);
    color: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    z-index: 10000;
    max-width: 300px;
    animation: slideIn 0.5s ease;
  `;
  
  popup.innerHTML = `
    <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">üíä Medication Reminder</div>
    <div style="font-size: 14px;">Time to take: <strong>${reminder.medication}</strong></div>
    <div style="font-size: 14px;">Dosage: <strong>${reminder.dose}</strong></div>
    <button onclick="this.parentElement.parentElement.remove()" style="
      background: white;
      color: #009688;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      margin-top: 10px;
      cursor: pointer;
    ">Got it!</button>
  `;
  
  // Add CSS animation
  const style = document.createElement('style');
  style.textContent = `
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
  `;
  document.head.appendChild(style);
  
  document.body.appendChild(popup);
  
  // Auto remove after 10 seconds
  setTimeout(() => {
    if (popup.parentElement) {
      popup.remove();
    }
  }, 10000);
  
  console.log('‚úÖ Fallback notification shown');
}

// WhatsApp message function
function sendWhatsAppMessage(reminder) {
  console.log('Sending WhatsApp message...');
  console.log('Reminder:', reminder);
  
  // Create a simple message
  const message = `üíä Medication Reminder

Time to take: ${reminder.medication}
Dosage: ${reminder.dose}
Date: ${reminder.date}
Time: ${reminder.time}

Stay healthy! üè•`;
  
  // Clean phone number (remove + and spaces)
  const cleanPhone = reminder.phone.replace(/[+\s-]/g, '');
  console.log('Cleaned phone:', cleanPhone);
  
  // Method 1: Try WhatsApp Web API
  try {
    const whatsappUrl = `https://wa.me/${cleanPhone}?text=${encodeURIComponent(message)}`;
    console.log('WhatsApp URL:', whatsappUrl);
    
    // Open WhatsApp Web
    const whatsappWindow = window.open(whatsappUrl, '_blank', 'width=800,height=600');
    
    if (whatsappWindow) {
      console.log('‚úÖ WhatsApp window opened');
      showNotificationStatus('‚úÖ WhatsApp opened! Complete the message and send.');
    } else {
      console.log('‚ùå Popup blocked, trying alternative method');
      showAlternativeWhatsApp(cleanPhone, message);
    }
  } catch (error) {
    console.error('Error opening WhatsApp:', error);
    showAlternativeWhatsApp(cleanPhone, message);
  }
}

// Alternative WhatsApp method
function showAlternativeWhatsApp(phone, message) {
  const modal = document.createElement('div');
  modal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
  `;
  
  modal.innerHTML = `
    <div style="
      background: white;
      padding: 30px;
      border-radius: 15px;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    ">
      <h3 style="color: #25D366; margin-bottom: 20px;">üì± WhatsApp Message</h3>
      <p style="margin-bottom: 15px;">Phone: <strong>+${phone}</strong></p>
      <div style="
        background: #f0f0f0;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        text-align: left;
        font-family: monospace;
        white-space: pre-line;
      ">${message}</div>
      <div style="margin: 20px 0;">
        <button onclick="copyToClipboard('${message}')" style="
          background: #25D366;
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 5px;
          margin: 5px;
          cursor: pointer;
        ">üìã Copy Message</button>
        <button onclick="openWhatsAppWeb('${phone}')" style="
          background: #25D366;
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 5px;
          margin: 5px;
          cursor: pointer;
        ">üí¨ Open WhatsApp</button>
        <button onclick="this.closest('div').parentElement.remove()" style="
          background: #666;
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 5px;
          margin: 5px;
          cursor: pointer;
        ">‚ùå Close</button>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
}

// Copy to clipboard function
function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    showNotificationStatus('‚úÖ Message copied to clipboard!');
  }).catch(() => {
    // Fallback for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    showNotificationStatus('‚úÖ Message copied to clipboard!');
  });
}

// Open WhatsApp Web function
function openWhatsAppWeb(phone) {
  const whatsappUrl = `https://web.whatsapp.com/send?phone=${phone}`;
  window.open(whatsappUrl, '_blank');
  showNotificationStatus('‚úÖ WhatsApp Web opened!');
}

// Test WhatsApp function
function testWhatsApp() {
  const phone = prompt('Enter phone number for testing (with country code):', '+1234567890');
  if (phone) {
    const testReminder = {
      phone: phone,
      medication: 'Test Medicine',
      dose: '500mg',
      date: new Date().toISOString().split('T')[0],
      time: new Date().toTimeString().split(' ')[0].substring(0, 5)
    };
    
    console.log('Testing WhatsApp with:', testReminder);
    sendWhatsAppMessage(testReminder);
  }
}

// Bubbles animation
const container = document.getElementById('bubbles');
for(let i=0;i<30;i++){
  const b = document.createElement('div');
  b.classList.add('bubble');
  const size = Math.random() * 50 + 10; // 10px to 60px
  b.style.width = b.style.height = size + 'px';
  b.style.setProperty('--scale', size/20);
  b.style.left = Math.random()*100 + 'vw';
  b.style.top = Math.random()*100 + 'vh';
  const duration = 10 + Math.random()*15; // 10-25s
  const delay = Math.random()*-duration;
  b.style.animationDuration = duration + 's';
  b.style.animationDelay = delay + 's';
  container.appendChild(b);
}
</script>

</body>
</html>
